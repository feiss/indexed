<!-- copyright 2015 Diego F. Goberna http://feiss.be -->
<!DOCTYPE html>
<html>
<head>
<meta charset="utf8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<title>8-bit indexed color in webgl - Drawing test</title>
<style>
html, body {
	margin: 0px;
	width: 100%;
	height: 100%;
	background-color: #000;
	overflow: hidden;
	font-family: monospace;
	color: #777;
}
a{
	color: #444;
}

ul{
	margin: 0;
	padding: 0;
	list-style-position: inside;
}
div{
	margin: 5px 10px;
}
</style>
</head>
<body>
	<canvas id="c"></canvas>
	<div>click on canvas for next draw test<br>
		<a href="https://github.com/feiss/indexed">View on GitHub</a></div>


<script src="twgl.min.js"></script>
<script src="indexed.render.js"></script>
<script src="indexed.engine.js"></script>
<script>


for (var i=10000, lookupTable=[]; i--;) {
	lookupTable.push(Math.random());
}
var zzz=0;
function lookup() {
	return ++zzz >= lookupTable.length ? lookupTable[zzz=0] : lookupTable[zzz];
}

document.getElementById('c').addEventListener('mousedown', function(ev){
	test= (test+1)%4;
	stage.clear(55);
});


var W= 320, H= 200;

var starttime= new Date().getTime();
var frames= 0;
var time= 0;
var test= 0;
var shapesamount= 100;

function render(dt) {
	time= dt;

	for (var i=0; i< shapesamount; i++){
		switch(test){
			case 0: stage.fb.putPixel(lookup()*256|0, lookup()*W|0, lookup()*H|0); break;
			case 1: stage.fb.drawLine(lookup()*256|0, lookup()*W|0, lookup()*H|0, lookup()*W|0, lookup()*H|0); break;
			case 2: stage.fb.drawRect(lookup()*256|0, lookup()*W|0, lookup()*H|0, lookup()*W|0, lookup()*H|0, true); break;
			case 3: stage.fb.drawRect(lookup()*256|0, lookup()*W|0, lookup()*H|0, lookup()*W|0, lookup()*H|0); break;
		}
	}	

	stage.flip();

	frames++;
	if (frames==60*10){
		console.log('fps: '+ Math.floor( (frames*1000)/(new Date().getTime()-starttime)*10)/10);
		starttime= new Date().getTime();
		frames= 0;
	}
	requestAnimationFrame(render);
}

var stage;

loadAssets([
	'res/basic.pal'
	],
	function(){
		stage= new Stage('c', W, H, 2);
		stage.setPalette(assets['basic.pal']);
		stage.clear(55);
		requestAnimationFrame(render);
	},
	function(progress){
	});


</script>





</body>

</html>


